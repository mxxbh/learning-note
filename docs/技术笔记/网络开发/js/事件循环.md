# 事件循环

## js 的运行机制

1. 所有同步任务都在主线程上顺序执行，称为执行栈。
2. 主线程之外，还存在任务队列，产生的异步任务会放置到任务队列中。
3. 执行栈中的所有同步任务执行完毕后，就会读取任务队列，开始依次执行对应的异步任务。
4. 主线程不断重复第三步直至任务队列为空。这个过程也称为事件循环。

## 任务类型

宏观任务包括：

- script 标签内的代码
- setTimeout、setInterval、setImmediate
- I/O
- UI rendering

微观任务包括：

- process.nextTick
- Promises
- Object.observe
- MutationObserver
- MessageChannel

## 异步事件执行顺序

1. 在执行栈为空时，先查看微观任务队列，如果微观队列为空执行第 3 步，不为空执行第 2 步。
2. 载入微观任务队列的所有任务，执行过程中产生的微观或宏观任务重新放入对应队列中，然后回到第 1 步。
3. 查看宏观任务队列，如果宏观队列为空程序结束，不为空执行第 4 步。
4. 载入宏观任务队列的第一个任务，执行过程中产生的微观或宏观任务重新放入对应队列中，然后回到第 1 步。
